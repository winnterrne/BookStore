<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Quản lý tồn kho</title>
  <link rel="stylesheet" href="admin.css">
  <style>
    .status-ok { color: #2e7d32; font-weight: 600; }
    .status-warning { color: #f57c00; font-weight: 600; }
    .status-danger { color: #d32f2f; font-weight: 600; }
    #warning { margin-top: 16px; line-height: 1.6; color: #d32f2f; font-weight: 600; }
    .table td { vertical-align: middle; }
    .ellipsis {
      max-width: 220px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      display: inline-block;
    }
  </style>
</head>
<body>

  <div class="custom-header">
    <div class="dashboard-title">DASHBOARD</div>
    <nav class="admin-nav-inline">
      <ul>
        <li><a href="dashboard.html">TỔNG QUAN</a></li>
        <li><a href="users.html">NGƯỜI DÙNG</a></li>
        <li><a href="categories.html">LOẠI SP</a></li>
        <li><a href="products.html">SẢN PHẨM</a></li>
        <li><a href="import.html">NHẬP HÀNG</a></li>
        <li><a href="pricing.html">GIÁ BÁN</a></li>
        <li><a href="orders.html">ĐƠN HÀNG</a></li>
        <li><a href="inventory.html" class="active">TỒN KHO</a></li>
        <li><a href="../index.html">THOÁT</a></li>
      </ul>
    </nav>
  </div>

  <main class="admin-content">
    <div class="page-title">
      <a href="dashboard.html">Quay lại Dashboard</a>
      Quản lý tồn kho
    </div>

    <div class="action-bar">
      <form class="orders-search-grid" style="grid-template-columns:1fr 1fr 120px !important; gap:12px !important; align-items:end !important;">

        <!-- NGÀY TRA CỨU -->
        <div class="input-with-label">
         <label>Ngày tra cứu:</label>
          <input type="text" placeholder="dd/mm/yyyy" 
             onfocus="(this.type='date')" 
             onblur="if(!this.value) this.type='text'">
        </div>

      <!-- TÌM KIẾM MÃ/TÊN -->
        <div class="input-with-label">
        <label>Mã sản phẩm hoặc tên:</label>
          <input type="text" id="searchInput" placeholder="Nhập để tìm nhanh">
        </div>

      <!-- NÚT TRA CỨU – ÉP CĂN ĐÁY 100% -->
        <div style="display:flex; align-items:end; height:100%;">
          <button type="submit" class="btn-add" 
              style="width:100%; height:44px; margin:0; padding:0 20px; font-weight:600;">
           Tra cứu
          </button>
        </div>

      </form>
    </div>

    <div class="content-box">
      <h2 class="section-title">Kết quả tồn kho</h2>
      <table class="table">
        <thead>
          <tr>
            <th>Mã SP</th>
            <th>Tên SP</th>
            <th>Tồn</th>
            <th>Đã bán</th>
            <th>Tổng nhập</th>
            <th>Trạng thái</th>
            <th>Hành động</th>
          </tr>
        </thead>
        <tbody id="inventoryBody">
          <!-- Dữ liệu sẽ được tự động thêm bởi JS -->
        </tbody>
      </table>

      <!-- PHÂN TRANG -->
      <div class="content-pagination">
        <div class="pagination">
          <button class="prev">&lt;</button>
          <button class="page active">1</button>
          <button class="page">2</button>
          <button class="page">3</button>
          <button class="page">4</button>
          <button class="page">5</button>
          <button class="next">&gt;</button>
        </div>
      </div>
      <p id="warning"></p>
    </div>
  </main>

<script src="../data-book.js"></script>
<script>
  const tbody = document.getElementById("inventoryBody");
  const warning = document.getElementById("warning");
  const searchForm = document.getElementById("searchForm");
  const searchInput = document.getElementById("searchInput");

  function seededRandom(seed) {
    const x = Math.sin(seed) * 10000;
    return x - Math.floor(x);
  }

  const products = books.map(item => {
    const seed = item.id * 12345;
    const minImport = item.stock + 15;
    const maxImport = item.stock + 120;
    const totalImported = Math.floor(seededRandom(seed) * (maxImport - minImport + 1)) + minImport;
    const sold = totalImported - item.stock;

    let status = "Còn hàng";
    let statusClass = "status-ok";
    if (item.stock === 0) {
      status = "Hết hàng";
      statusClass = "status-danger";
    } else if (item.stock <= 10) {
      status = "Sắp hết";
      statusClass = "status-warning";
    }

    return {
      id: item.id,
      title: item.title,
      stock: item.stock,
      sold: sold,
      totalImported: totalImported,
      status: status,
      statusClass: statusClass,
      image: item.image
    };
  });

  function display(list) {
    tbody.innerHTML = "";
    warning.innerHTML = "";
    const modalsContainer = document.createElement('div');
    document.body.appendChild(modalsContainer);

    list.forEach(p => {
      tbody.innerHTML += `
        <tr>
          <!-- CỘT MÃ SP -->
          <td style="text-align:center; font-weight:700; color:#2e7d32; width:60px;">
            ${p.id}
          </td>

          <!-- CỘT TÊN SP + ẢNH – DÙNG TABLE-CELL ĐỂ CĂN CHỈNH HOÀN HẢO -->
          <td style="padding:14px 16px !important;">
            <div style="display:flex; align-items:center; gap:14px; height:100%;">
              <img src="../${p.image}"
                   onerror="this.src='../images/no-image.jpg'"
                   style="width:56px; height:78px; object-fit:cover; border-radius:8px; 
                          box-shadow:0 3px 10px rgba(0,0,0,0.2); transition:all .3s; cursor:zoom-in;
                          flex-shrink:0;"
                   onmouseover="this.style.transform='scale(2.5)'; this.style.zIndex='999'; this.style.boxShadow='0 15px 40px rgba(0,0,0,0.4)'"
                   onmouseout="this.style.transform='scale(1)'; this.style.zIndex='1'; this.style.boxShadow='0 3px 10px rgba(0,0,0,0.2)'">
              <div style="min-width:0;">
                <div title="${p.title}"
                     style="font-weight:600; color:#222; max-width:320px; white-space:nowrap; 
                            overflow:hidden; text-overflow:ellipsis; line-height:1.4;">
                  ${p.title}
                </div>
                <small style="color:#666; font-size:12px;">ID: ${p.id}</small>
              </div>
            </div>
          </td>

          <!-- CÁC CỘT CÒN LẠI – CĂN GIỮA, ĐẸP NHƯ ADMIN.CSS -->
          <td style="text-align:center; padding:14px 16px !important;">
            <strong style="font-size:18px; color:#2e7d32;">${p.stock}</strong>
          </td>
          <td style="text-align:center; padding:14px 16px !important;">${p.sold}</td>
          <td style="text-align:center; padding:14px 16px !important;">${p.totalImported}</td>
          <td style="text-align:center; padding:14px 16px !important;">
            <span class="${p.statusClass}">${p.status}</span>
          </td>
          <td style="text-align:center; padding:14px 16px !important;">
            <a href="#editModal-${p.id}" class="btn-small btn-reset">Sửa</a>
            <a href="#deleteModal-${p.id}" class="btn-small btn-lock">Xóa</a>
          </td>
        </tr>
      `;

      if (p.stock <= 10) {
        warning.innerHTML += `Cảnh báo: <strong>${p.title}</strong> chỉ còn <strong>${p.stock}</strong> cuốn!<br>`;
      }

      // Generate modals dynamically (interface-only)
      modalsContainer.innerHTML += `
        <!-- Edit Modal for ${p.id} -->
        <div id="editModal-${p.id}" class="modal">
          <div class="modal-content">
            <div class="modal-header">
              <div class="modal-title">Sửa tồn kho</div>
              <a href="#" class="modal-close">×</a>
            </div>
            <form class="modal-form">
              <div><label>Mã SP</label><input type="text" value="${p.id}" disabled></div>
              <div><label>Tên SP</label><input type="text" value="${p.title}" disabled></div>
              <div><label>Tồn</label><input type="number" value="${p.stock}"></div>
              <div><label>Đã bán</label><input type="number" value="${p.sold}"></div>
              <div><label>Tổng nhập</label><input type="number" value="${p.totalImported}"></div>
              <div class="modal-actions">
                <a href="#" class="btn-save" onclick="alert('Đã lưu!')">Lưu</a>
                <a href="#" class="btn-cancel">Hủy</a>
              </div>
            </form>
          </div>
        </div>

        <!-- Delete Modal for ${p.id} -->
        <div id="deleteModal-${p.id}" class="modal">
          <div class="modal-content">
            <div class="modal-header">
              <div class="modal-title">Xác nhận xóa</div>
              <a href="#" class="modal-close">×</a>
            </div>
            <div class="confirm-delete">
              <p>Bạn có chắc muốn xóa <strong>${p.title}</strong> không?</p>
              <div class="modal-actions">
                <a href="#" class="btn-save" style="background:#d32f2f;" onclick="alert('Đã xóa!')">Xóa</a>
                <a href="#" class="btn-cancel">Hủy</a>
              </div>
            </div>
          </div>
        </div>
      `;
    });
  }

  display(products);

  searchForm.addEventListener("submit", e => {
    e.preventDefault();
    const query = searchInput.value.trim().toLowerCase();
    const filtered = products.filter(p =>
      p.id.toString().includes(query) || p.title.toLowerCase().includes(query)
    );
    display(filtered);
  });
</script>

<script>
  // PHÂN TRANG NHƯNG CHỈ NHẢY MÀU
  document.addEventListener("DOMContentLoaded", () => {
    const pages = document.querySelectorAll('.pagination .page');
    const prevBtn = document.querySelector('.pagination .prev');
    const nextBtn = document.querySelector('.pagination .next');

    function setActive(index) {
      pages.forEach(p => p.classList.remove('active'));
      pages[index].classList.add('active');
      prevBtn.disabled = index === 0;
      nextBtn.disabled = index === pages.length - 1;
    }

    pages.forEach((btn, idx) => {
      btn.addEventListener('click', () => setActive(idx));
    });

    prevBtn.addEventListener('click', () => {
      let current = [...pages].findIndex(p => p.classList.contains('active'));
      if (current > 0) setActive(current - 1);
    });

    nextBtn.addEventListener('click', () => {
      let current = [...pages].findIndex(p => p.classList.contains('active'));
      if (current < pages.length - 1) setActive(current + 1);
    });

    setActive(0); // Trang 1 được chọn ban đầu
  });
</script>

</body>
</html>